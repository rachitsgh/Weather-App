var should = require("should");
var AggreProto = require("../lib/AggreProto");
var Builder  = require("../lib/Builder");

describe("AggreProto",function(){
	var aggre,aggobj;
	var builder = new Builder();

	it("new",function(){
		builder.bindAgg({typeName:"myAggre",init:function(data){return data;},methods:{changeName:function(arg,my){console.log(arg.name);console.log(my);}}});
		builder.bindDB({save:function(){},remove:function(){},get:function(){}})
		builder.bindEventHandle(true,"event01",function(){console.log("have event  01")})
		builder.bindService("service01",function(){
			console.log("hello world!");
		})
		
		aggre = builder._AggreTypes["myAggre"];
		aggobj =  new aggre({name:"leo"});			
	});

	it("__data",function(){
		aggobj.should.have.property("__data");
		aggobj.__data("name","brighthas");
		aggobj._data.name.should.equal("brighthas");
	});
	
	it("id",function(){
		should.exist(aggobj.id)
	});
	
	it("_getAgg",function(){
		var T = aggobj._getAgg("myAggre");
		T.should.be.a("function")
	});
	
	it("data",function(){
		aggobj.data("name").should.be.a("string");
	});
	
	it("_service",function(){
		aggobj._service("service01")
        aggobj.changeName({name:"leo"})
	})
	
	it("_publish",function(){
		aggobj._publish("event01");
	})
	
	
	it("remove",function(){
		var id  =  aggobj.id;
		var T = aggobj._getAgg("myAggre");
		T.get(id,function(obj){
			should.exist(obj);
		})
		aggobj.remove.should.be.a("function");
		aggobj.remove();
		var T = aggobj._getAgg("myAggre");
		T.get(id,function(obj){
			should.not.exist(obj);
		})
	})

});